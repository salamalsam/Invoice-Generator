<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <title>Invoice Generator</title>
    <link href="style.css" rel="stylesheet" />
</head>
<body>
    <div class="container-fluid">
        <div class="h2 text-center">Invoice Generator POS</div>
        <div class="row">
            <div class="col-md-4">
                <div class="row my_custom_row">
                    <div class="col-md-4">
                        <div class="card" style="width: 100%;" product_id="20" product_name="Banana Shake" price="140">
                            <h5>Banana Shake</h5>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card" style="width: 100%;" product_id="21" product_name="Strawberry Shake" price="160">
                            <h5>Strawberry Shake</h5>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card" style="width: 100%;" product_id="22" product_name="Milk Shake" price="120">
                            <h5>Milk Shake</h5>
                        </div>
                    </div>
                </div>

            </div>
            <div class="col-md-8">
                <h4 class="text-center">Invoice</h4>
                <table class="table table-strip">
                    <thead>
                        <tr>
                            <th>Code</th>
                            <th>Product Name</th>
                            <th>Price</th>
                            <th>Quantity</th>
                            <th>Amount</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
                <h4 class="text-end" id="total_amount">Total: 0</h4>
            </div>
        </div>
    </div>



    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.3.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>
    <script>
        $('.card').click(function(){

            var product_id = $(this).attr('product_id');
            var product_name = $(this).attr('product_name');
            var product_price = $(this).attr('price');
            if (!$(`tbody tr td:first-child:contains('${product_id}')`).length) {
            $('tbody').append(`<tr>
                            <td>#${product_id}</td>
                            <td>${product_name}</td>
                            <td class="product_price">${product_price}</td>
                            <td><button onclick="decrease_quantity(this);">-</button><input type="text" value="1"><button onclick="increase_quantity(this);">+</button></td>
                            <td class="calculated_item_price">${product_price}</td>
                            <td>
                                <button onclick="remove_item(this)">Remove Item</button>
                            </td>
                        </tr > `);
                        _calculate_total();
            }
        });
        function remove_item(item_obj) {
            $(item_obj).parent().parent().remove();
            _calculate_total();
        }
        function decrease_quantity(quantity_obj) {
            var previous_value = $(quantity_obj).siblings('input').val();
            if (previous_value > 1) {
                $(quantity_obj).siblings('input').val(parseInt(previous_value) - 1);
                var product_price = $(quantity_obj)
                                    .parent()
                                    .siblings('.product_price')
                                    .text();
                $(quantity_obj)
                    .parent()
                    .siblings('.calculated_item_price')
                    .text(
                        (parseInt(previous_value) - 1) * product_price
                    );
            } 
            _calculate_total();
        }
        function increase_quantity(quantity_obj) {
            var previous_value = $(quantity_obj).siblings('input').val();
            $(quantity_obj).siblings('input').val(parseInt(previous_value) + 1);
            var product_price = $(quantity_obj).parent().siblings('.product_price').text();
            $(quantity_obj).parent().siblings('.calculated_item_price').text((parseInt(previous_value) + 1) * product_price);
            _calculate_total();
        }
        function _calculate_total(){
            var total_= 0;
            $('.calculated_item_price').each(function( index ) {
                total_ = total_ + parseInt($(this).text());
                });
            $('#total_amount').text('Total: '+total_);
            console.log(total_);
        }
    </script>
</body>
</html>